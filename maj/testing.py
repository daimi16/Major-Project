from flask import Flask, request,jsonify
from flask_cors import CORS
from tensorflow import keras
from PIL import Image, ImageOps
import numpy as np
import cv2
import base64
import PIL.Image as Image
import io


lab={0: 'ABBOTTS BABBLER',
 1: 'ABBOTTS BOOBY',
 2: 'ABYSSINIAN GROUND HORNBILL',
 3: 'AFRICAN CROWNED CRANE',
 4: 'AFRICAN EMERALD CUCKOO',
 5: 'AFRICAN FIREFINCH',
 6: 'AFRICAN OYSTER CATCHER',
 7: 'AFRICAN PIED HORNBILL',
 8: 'AFRICAN PYGMY GOOSE',
 9: 'ALBATROSS',
 10: 'ALBERTS TOWHEE',
 11: 'ALEXANDRINE PARAKEET',
 12: 'ALPINE CHOUGH',
 13: 'ALTAMIRA YELLOWTHROAT',
 14: 'AMERICAN AVOCET',
 15: 'AMERICAN BITTERN',
 16: 'AMERICAN COOT',
 17: 'AMERICAN FLAMINGO',
 18: 'AMERICAN GOLDFINCH',
 19: 'AMERICAN KESTREL',
 20: 'AMERICAN PIPIT',
 21: 'AMERICAN REDSTART',
 22: 'AMERICAN ROBIN',
 23: 'AMERICAN WIGEON',
 24: 'AMETHYST WOODSTAR',
 25: 'ANDEAN GOOSE',
 26: 'ANDEAN LAPWING',
 27: 'ANDEAN SISKIN',
 28: 'ANHINGA',
 29: 'ANIANIAU',
 30: 'ANNAS HUMMINGBIRD',
 31: 'ANTBIRD',
 32: 'ANTILLEAN EUPHONIA',
 33: 'APAPANE',
 34: 'APOSTLEBIRD',
 35: 'ARARIPE MANAKIN',
 36: 'ASHY STORM PETREL',
 37: 'ASHY THRUSHBIRD',
 38: 'ASIAN CRESTED IBIS',
 39: 'ASIAN DOLLARD BIRD',
 40: 'ASIAN GREEN BEE EATER',
 41: 'ASIAN OPENBILL STORK',
 42: 'AUCKLAND SHAQ',
 43: 'AUSTRAL CANASTERO',
 44: 'AUSTRALASIAN FIGBIRD',
 45: 'AVADAVAT',
 46: 'AZARAS SPINETAIL',
 47: 'AZURE BREASTED PITTA',
 48: 'AZURE JAY',
 49: 'AZURE TANAGER',
 50: 'AZURE TIT',
 51: 'BAIKAL TEAL',
 52: 'BALD EAGLE',
 53: 'BALD IBIS',
 54: 'BALI STARLING',
 55: 'BALTIMORE ORIOLE',
 56: 'BANANAQUIT',
 57: 'BAND TAILED GUAN',
 58: 'BANDED BROADBILL',
 59: 'BANDED PITA',
 60: 'BANDED STILT',
 61: 'BAR-TAILED GODWIT',
 62: 'BARN OWL',
 63: 'BARN SWALLOW',
 64: 'BARRED PUFFBIRD',
 65: 'BARROWS GOLDENEYE',
 66: 'BAY-BREASTED WARBLER',
 67: 'BEARDED BARBET',
 68: 'BEARDED BELLBIRD',
 69: 'BEARDED REEDLING',
 70: 'BELTED KINGFISHER',
 71: 'BIRD OF PARADISE',
 72: 'BLACK AND YELLOW BROADBILL',
 73: 'BLACK BAZA',
 74: 'BLACK COCKATO',
 75: 'BLACK FACED SPOONBILL',
 76: 'BLACK FRANCOLIN',
 77: 'BLACK HEADED CAIQUE',
 78: 'BLACK NECKED STILT',
 79: 'BLACK SKIMMER',
 80: 'BLACK SWAN',
 81: 'BLACK TAIL CRAKE',
 82: 'BLACK THROATED BUSHTIT',
 83: 'BLACK THROATED HUET',
 84: 'BLACK THROATED WARBLER',
 85: 'BLACK VENTED SHEARWATER',
 86: 'BLACK VULTURE',
 87: 'BLACK-CAPPED CHICKADEE',
 88: 'BLACK-NECKED GREBE',
 89: 'BLACK-THROATED SPARROW',
 90: 'BLACKBURNIAM WARBLER',
 91: 'BLONDE CRESTED WOODPECKER',
 92: 'BLOOD PHEASANT',
 93: 'BLUE COAU',
 94: 'BLUE DACNIS',
 95: 'BLUE GRAY GNATCATCHER',
 96: 'BLUE GROSBEAK',
 97: 'BLUE GROUSE',
 98: 'BLUE HERON',
 99: 'BLUE MALKOHA',
 100: 'BLUE THROATED TOUCANET',
 101: 'BOBOLINK',
 102: 'BORNEAN BRISTLEHEAD',
 103: 'BORNEAN LEAFBIRD',
 104: 'BORNEAN PHEASANT',
 105: 'BRANDT CORMARANT',
 106: 'BREWERS BLACKBIRD',
 107: 'BROWN CREPPER',
 108: 'BROWN HEADED COWBIRD',
 109: 'BROWN NOODY',
 110: 'BROWN THRASHER',
 111: 'BUFFLEHEAD',
 112: 'BULWERS PHEASANT',
 113: 'BURCHELLS COURSER',
 114: 'BUSH TURKEY',
 115: 'CAATINGA CACHOLOTE',
 116: 'CABOTS TRAGOPAN',
 117: 'CACTUS WREN',
 118: 'CALIFORNIA CONDOR',
 119: 'CALIFORNIA GULL',
 120: 'CALIFORNIA QUAIL',
 121: 'CAMPO FLICKER',
 122: 'CANARY',
 123: 'CANVASBACK',
 124: 'CAPE GLOSSY STARLING',
 125: 'CAPE LONGCLAW',
 126: 'CAPE MAY WARBLER',
 127: 'CAPE ROCK THRUSH',
 128: 'CAPPED HERON',
 129: 'CAPUCHINBIRD',
 130: 'CARMINE BEE-EATER',
 131: 'CASPIAN TERN',
 132: 'CASSOWARY',
 133: 'CEDAR WAXWING',
 134: 'CERULEAN WARBLER',
 135: 'CHARA DE COLLAR',
 136: 'CHATTERING LORY',
 137: 'CHESTNET BELLIED EUPHONIA',
 138: 'CHESTNUT WINGED CUCKOO',
 139: 'CHINESE BAMBOO PARTRIDGE',
 140: 'CHINESE POND HERON',
 141: 'CHIPPING SPARROW',
 142: 'CHUCAO TAPACULO',
 143: 'CHUKAR PARTRIDGE',
 144: 'CINNAMON ATTILA',
 145: 'CINNAMON FLYCATCHER',
 146: 'CINNAMON TEAL',
 147: 'CLARKS GREBE',
 148: 'CLARKS NUTCRACKER',
 149: 'COCK OF THE  ROCK',
 150: 'COCKATOO',
 151: 'COLLARED ARACARI',
 152: 'COLLARED CRESCENTCHEST',
 153: 'COMMON FIRECREST',
 154: 'COMMON GRACKLE',
 155: 'COMMON HOUSE MARTIN',
 156: 'COMMON IORA',
 157: 'COMMON LOON',
 158: 'COMMON POORWILL',
 159: 'COMMON STARLING',
 160: 'COPPERSMITH BARBET',
 161: 'COPPERY TAILED COUCAL',
 162: 'CRAB PLOVER',
 163: 'CRANE HAWK',
 164: 'CREAM COLORED WOODPECKER',
 165: 'CRESTED AUKLET',
 166: 'CRESTED CARACARA',
 167: 'CRESTED COUA',
 168: 'CRESTED FIREBACK',
 169: 'CRESTED KINGFISHER',
 170: 'CRESTED NUTHATCH',
 171: 'CRESTED OROPENDOLA',
 172: 'CRESTED SERPENT EAGLE',
 173: 'CRESTED SHRIKETIT',
 174: 'CRESTED WOOD PARTRIDGE',
 175: 'CRIMSON CHAT',
 176: 'CRIMSON SUNBIRD',
 177: 'CROW',
 178: 'CUBAN TODY',
 179: 'CUBAN TROGON',
 180: 'CURL CRESTED ARACURI',
 181: 'D-ARNAUDS BARBET',
 182: 'DALMATIAN PELICAN',
 183: 'DARJEELING WOODPECKER',
 184: 'DARK EYED JUNCO',
 185: 'DAURIAN REDSTART',
 186: 'DEMOISELLE CRANE',
 187: 'DOUBLE BARRED FINCH',
 188: 'DOUBLE BRESTED CORMARANT',
 189: 'DOUBLE EYED FIG PARROT',
 190: 'DOWNY WOODPECKER',
 191: 'DUSKY LORY',
 192: 'DUSKY ROBIN',
 193: 'EARED PITA',
 194: 'EASTERN BLUEBIRD',
 195: 'EASTERN BLUEBONNET',
 196: 'EASTERN GOLDEN WEAVER',
 197: 'EASTERN MEADOWLARK',
 198: 'EASTERN ROSELLA',
 199: 'EASTERN TOWEE',
 200: 'EASTERN WIP POOR WILL',
 201: 'EASTERN YELLOW ROBIN',
 202: 'ECUADORIAN HILLSTAR',
 203: 'EGYPTIAN GOOSE',
 204: 'ELEGANT TROGON',
 205: 'ELLIOTS  PHEASANT',
 206: 'EMERALD TANAGER',
 207: 'EMPEROR PENGUIN',
 208: 'EMU',
 209: 'ENGGANO MYNA',
 210: 'EURASIAN BULLFINCH',
 211: 'EURASIAN GOLDEN ORIOLE',
 212: 'EURASIAN MAGPIE',
 213: 'EUROPEAN GOLDFINCH',
 214: 'EUROPEAN TURTLE DOVE',
 215: 'EVENING GROSBEAK',
 216: 'FAIRY BLUEBIRD',
 217: 'FAIRY PENGUIN',
 218: 'FAIRY TERN',
 219: 'FAN TAILED WIDOW',
 220: 'FASCIATED WREN',
 221: 'FIERY MINIVET',
 222: 'FIORDLAND PENGUIN',
 223: 'FIRE TAILLED MYZORNIS',
 224: 'FLAME BOWERBIRD',
 225: 'FLAME TANAGER',
 226: 'FOREST WAGTAIL',
 227: 'FRIGATE',
 228: 'FRILL BACK PIGEON',
 229: 'GAMBELS QUAIL',
 230: 'GANG GANG COCKATOO',
 231: 'GILA WOODPECKER',
 232: 'GILDED FLICKER',
 233: 'GLOSSY IBIS',
 234: 'GO AWAY BIRD',
 235: 'GOLD WING WARBLER',
 236: 'GOLDEN BOWER BIRD',
 237: 'GOLDEN CHEEKED WARBLER',
 238: 'GOLDEN CHLOROPHONIA',
 239: 'GOLDEN EAGLE',
 240: 'GOLDEN PARAKEET',
 241: 'GOLDEN PHEASANT',
 242: 'GOLDEN PIPIT',
 243: 'GOULDIAN FINCH',
 244: 'GRANDALA',
 245: 'GRAY CATBIRD',
 246: 'GRAY KINGBIRD',
 247: 'GRAY PARTRIDGE',
 248: 'GREAT ARGUS',
 249: 'GREAT GRAY OWL',
 250: 'GREAT JACAMAR',
 251: 'GREAT KISKADEE',
 252: 'GREAT POTOO',
 253: 'GREAT TINAMOU',
 254: 'GREAT XENOPS',
 255: 'GREATER PEWEE',
 256: 'GREATER PRAIRIE CHICKEN',
 257: 'GREATOR SAGE GROUSE',
 258: 'GREEN BROADBILL',
 259: 'GREEN JAY',
 260: 'GREEN MAGPIE',
 261: 'GREEN WINGED DOVE',
 262: 'GREY CUCKOOSHRIKE',
 263: 'GREY HEADED FISH EAGLE',
 264: 'GREY PLOVER',
 265: 'GROVED BILLED ANI',
 266: 'GUINEA TURACO',
 267: 'GUINEAFOWL',
 268: 'GURNEYS PITTA',
 269: 'GYRFALCON',
 270: 'HAMERKOP',
 271: 'HARLEQUIN DUCK',
 272: 'HARLEQUIN QUAIL',
 273: 'HARPY EAGLE',
 274: 'HAWAIIAN GOOSE',
 275: 'HAWFINCH',
 276: 'HELMET VANGA',
 277: 'HEPATIC TANAGER',
 278: 'HIMALAYAN BLUETAIL',
 279: 'HIMALAYAN MONAL',
 280: 'HOATZIN',
 281: 'HOODED MERGANSER',
 282: 'HOOPOES',
 283: 'HORNED GUAN',
 284: 'HORNED LARK',
 285: 'HORNED SUNGEM',
 286: 'HOUSE FINCH',
 287: 'HOUSE SPARROW',
 288: 'HYACINTH MACAW',
 289: 'IBERIAN MAGPIE',
 290: 'IBISBILL',
 291: 'IMPERIAL SHAQ',
 292: 'INCA TERN',
 293: 'INDIAN BUSTARD',
 294: 'INDIAN PITTA',
 295: 'INDIAN ROLLER',
 296: 'INDIAN VULTURE',
 297: 'INDIGO BUNTING',
 298: 'INDIGO FLYCATCHER',
 299: 'INLAND DOTTEREL',
 300: 'IVORY BILLED ARACARI',
 301: 'IVORY GULL',
 302: 'IWI',
 303: 'JABIRU',
 304: 'JACK SNIPE',
 305: 'JACOBIN PIGEON',
 306: 'JANDAYA PARAKEET',
 307: 'JAPANESE ROBIN',
 308: 'JAVA SPARROW',
 309: 'JOCOTOCO ANTPITTA',
 310: 'KAGU',
 311: 'KAKAPO',
 312: 'KILLDEAR',
 313: 'KING EIDER',
 314: 'KING VULTURE',
 315: 'KIWI',
 316: 'KOOKABURRA',
 317: 'LARK BUNTING',
 318: 'LAUGHING GULL',
 319: 'LAZULI BUNTING',
 320: 'LESSER ADJUTANT',
 321: 'LILAC ROLLER',
 322: 'LIMPKIN',
 323: 'LITTLE AUK',
 324: 'LOGGERHEAD SHRIKE',
 325: 'LONG-EARED OWL',
 326: 'LOONEY BIRDS',
 327: 'LUCIFER HUMMINGBIRD',
 328: 'MAGPIE GOOSE',
 329: 'MALABAR HORNBILL',
 330: 'MALACHITE KINGFISHER',
 331: 'MALAGASY WHITE EYE',
 332: 'MALEO',
 333: 'MALLARD DUCK',
 334: 'MANDRIN DUCK',
 335: 'MANGROVE CUCKOO',
 336: 'MARABOU STORK',
 337: 'MASKED BOBWHITE',
 338: 'MASKED BOOBY',
 339: 'MASKED LAPWING',
 340: 'MCKAYS BUNTING',
 341: 'MERLIN',
 342: 'MIKADO  PHEASANT',
 343: 'MILITARY MACAW',
 344: 'MOURNING DOVE',
 345: 'MYNA',
 346: 'NICOBAR PIGEON',
 347: 'NOISY FRIARBIRD',
 348: 'NORTHERN BEARDLESS TYRANNULET',
 349: 'NORTHERN CARDINAL',
 350: 'NORTHERN FLICKER',
 351: 'NORTHERN FULMAR',
 352: 'NORTHERN GANNET',
 353: 'NORTHERN GOSHAWK',
 354: 'NORTHERN JACANA',
 355: 'NORTHERN MOCKINGBIRD',
 356: 'NORTHERN PARULA',
 357: 'NORTHERN RED BISHOP',
 358: 'NORTHERN SHOVELER',
 359: 'OCELLATED TURKEY',
 360: 'OKINAWA RAIL',
 361: 'ORANGE BREASTED TROGON',
 362: 'ORANGE BRESTED BUNTING',
 363: 'ORIENTAL BAY OWL',
 364: 'ORNATE HAWK EAGLE',
 365: 'OSPREY',
 366: 'OSTRICH',
 367: 'OVENBIRD',
 368: 'OYSTER CATCHER',
 369: 'PAINTED BUNTING',
 370: 'PALILA',
 371: 'PALM NUT VULTURE',
 372: 'PARADISE TANAGER',
 373: 'PARAKETT  AKULET',
 374: 'PARUS MAJOR',
 375: 'PATAGONIAN SIERRA FINCH',
 376: 'PEACOCK',
 377: 'PEREGRINE FALCON',
 378: 'PHAINOPEPLA',
 379: 'PHILIPPINE EAGLE',
 380: 'PINK ROBIN',
 381: 'PLUSH CRESTED JAY',
 382: 'POMARINE JAEGER',
 383: 'PUFFIN',
 384: 'PUNA TEAL',
 385: 'PURPLE FINCH',
 386: 'PURPLE GALLINULE',
 387: 'PURPLE MARTIN',
 388: 'PURPLE SWAMPHEN',
 389: 'PYGMY KINGFISHER',
 390: 'PYRRHULOXIA',
 391: 'QUETZAL',
 392: 'RAINBOW LORIKEET',
 393: 'RAZORBILL',
 394: 'RED BEARDED BEE EATER',
 395: 'RED BELLIED PITTA',
 396: 'RED BILLED TROPICBIRD',
 397: 'RED BROWED FINCH',
 398: 'RED FACED CORMORANT',
 399: 'RED FACED WARBLER',
 400: 'RED FODY',
 401: 'RED HEADED DUCK',
 402: 'RED HEADED WOODPECKER',
 403: 'RED KNOT',
 404: 'RED LEGGED HONEYCREEPER',
 405: 'RED NAPED TROGON',
 406: 'RED SHOULDERED HAWK',
 407: 'RED TAILED HAWK',
 408: 'RED TAILED THRUSH',
 409: 'RED WINGED BLACKBIRD',
 410: 'RED WISKERED BULBUL',
 411: 'REGENT BOWERBIRD',
 412: 'RING-NECKED PHEASANT',
 413: 'ROADRUNNER',
 414: 'ROCK DOVE',
 415: 'ROSE BREASTED COCKATOO',
 416: 'ROSE BREASTED GROSBEAK',
 417: 'ROSEATE SPOONBILL',
 418: 'ROSY FACED LOVEBIRD',
 419: 'ROUGH LEG BUZZARD',
 420: 'ROYAL FLYCATCHER',
 421: 'RUBY CROWNED KINGLET',
 422: 'RUBY THROATED HUMMINGBIRD',
 423: 'RUDDY SHELDUCK',
 424: 'RUDY KINGFISHER',
 425: 'RUFOUS KINGFISHER',
 426: 'RUFOUS TREPE',
 427: 'RUFUOS MOTMOT',
 428: 'SAMATRAN THRUSH',
 429: 'SAND MARTIN',
 430: 'SANDHILL CRANE',
 431: 'SATYR TRAGOPAN',
 432: 'SAYS PHOEBE',
 433: 'SCARLET CROWNED FRUIT DOVE',
 434: 'SCARLET FACED LIOCICHLA',
 435: 'SCARLET IBIS',
 436: 'SCARLET MACAW',
 437: 'SCARLET TANAGER',
 438: 'SHOEBILL',
 439: 'SHORT BILLED DOWITCHER',
 440: 'SMITHS LONGSPUR',
 441: 'SNOW GOOSE',
 442: 'SNOW PARTRIDGE',
 443: 'SNOWY EGRET',
 444: 'SNOWY OWL',
 445: 'SNOWY PLOVER',
 446: 'SORA',
 447: 'SPANGLED COTINGA',
 448: 'SPLENDID WREN',
 449: 'SPOON BILED SANDPIPER',
 450: 'SPOTTED CATBIRD',
 451: 'SPOTTED WHISTLING DUCK',
 452: 'SQUACCO HERON',
 453: 'SRI LANKA BLUE MAGPIE',
 454: 'STEAMER DUCK',
 455: 'STORK BILLED KINGFISHER',
 456: 'STRIATED CARACARA',
 457: 'STRIPED OWL',
 458: 'STRIPPED MANAKIN',
 459: 'STRIPPED SWALLOW',
 460: 'SUNBITTERN',
 461: 'SUPERB STARLING',
 462: 'SURF SCOTER',
 463: 'SWINHOES PHEASANT',
 464: 'TAILORBIRD',
 465: 'TAIWAN MAGPIE',
 466: 'TAKAHE',
 467: 'TASMANIAN HEN',
 468: 'TAWNY FROGMOUTH',
 469: 'TEAL DUCK',
 470: 'TIT MOUSE',
 471: 'TOUCHAN',
 472: 'TOWNSENDS WARBLER',
 473: 'TREE SWALLOW',
 474: 'TRICOLORED BLACKBIRD',
 475: 'TROPICAL KINGBIRD',
 476: 'TRUMPTER SWAN',
 477: 'TURKEY VULTURE',
 478: 'TURQUOISE MOTMOT',
 479: 'UMBRELLA BIRD',
 480: 'VARIED THRUSH',
 481: 'VEERY',
 482: 'VENEZUELIAN TROUPIAL',
 483: 'VERDIN',
 484: 'VERMILION FLYCATHER',
 485: 'VICTORIA CROWNED PIGEON',
 486: 'VIOLET BACKED STARLING',
 487: 'VIOLET CUCKOO',
 488: 'VIOLET GREEN SWALLOW',
 489: 'VIOLET TURACO',
 490: 'VISAYAN HORNBILL',
 491: 'VULTURINE GUINEAFOWL',
 492: 'WALL CREAPER',
 493: 'WATTLED CURASSOW',
 494: 'WATTLED LAPWING',
 495: 'WHIMBREL',
 496: 'WHITE BREASTED WATERHEN',
 497: 'WHITE BROWED CRAKE',
 498: 'WHITE CHEEKED TURACO',
 499: 'WHITE CRESTED HORNBILL',
 500: 'WHITE EARED HUMMINGBIRD',
 501: 'WHITE NECKED RAVEN',
 502: 'WHITE TAILED TROPIC',
 503: 'WHITE THROATED BEE EATER',
 504: 'WILD TURKEY',
 505: 'WILLOW PTARMIGAN',
 506: 'WILSONS BIRD OF PARADISE',
 507: 'WOOD DUCK',
 508: 'WOOD THRUSH',
 509: 'WOODLAND KINGFISHER',
 510: 'WRENTIT',
 511: 'YELLOW BELLIED FLOWERPECKER',
 512: 'YELLOW CACIQUE',
 513: 'YELLOW HEADED BLACKBIRD',
 514: 'ZEBRA DOVE'}
model = keras.models.load_model('C:/Users/sabda/OneDrive/Desktop/Major Project/dataset/EfficientNetB0-515-(224 X 224)- 98.95.h5',compile=False)
def upload_predict(upload_images, model):
    
        size = (224,224)    
        image = ImageOps.fit(upload_images, size, Image.ANTIALIAS)
        image = np.asarray(image)
        img = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
        img_resize = cv2.resize(img, dsize=(224, 224),interpolation=cv2.INTER_CUBIC)
        
        img_reshape = img_resize[np.newaxis,...]
        
    
        prediction = model.predict(img_reshape)
        print(prediction)
        y_class = prediction.argmax(axis=-1)
        print(y_class)
        y = " ".join(str(x) for x in y_class)
        y = int(y)
        res = lab[y]
        print(res)
        return res
        
app = Flask(__name__)
cors = CORS(app,resources={r'*':{'origins':'*'}})

@app.route("/",methods=["GET"])
def index():
      
      return "hello world"

@app.route("/predict",methods=["POST"])
def pred():
     
     file=request.form["image"]
     
    #  with open("imageToSave.jpg", "wb") as fh:
    #        fh.write(base64.b64decode(file.split(",")[1]))
     
     image=Image.open(io.BytesIO(base64.b64decode(file.split(",")[1])))
     result=upload_predict(image,model)
     return jsonify(result)


if __name__ == "__main__":
    app.run(debug=True)
        
        




                    
    
